<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.codeyang.auth.mapper.AuthorityMapper">

    <select id="findAuthoritiesByUserId" resultType="cn.codeyang.auth.entity.Authority">
        select *
        from t_authority Authority
        where Authority.id in (
            select authority_id
            from t_role_authority ra
            where ra.role_id in (
                select ur.id from t_user_role ur where ur.user_id = #{userId;jdbcType=INTEGER}
            )
            union
            select authority_id
            from t_user_authority ua
            where ua.user_id = #{userId;jdbcType=INTEGER}
              and ua.type = 1
        )
          and Authority.id not in (
            select ua.authority_id
            from t_user_authority ua
            where ua.user_id = #{userId;jdbcType=INTEGER} and ua.type = -1
        )
        order by Authority.orders asc
    </select>

</mapper>